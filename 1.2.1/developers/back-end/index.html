<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Back end AngularJS - Openveo Core</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Back end AngularJS";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Openveo Core</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">INTRODUCTION</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>USERS</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../prerequisites/">Prerequisites</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/">Getting started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../web-service/">Web Service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../advanced-configuration/">Advanced configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../scalability/">Scalability</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../production/">Production</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>DEVELOPERS</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../basics/">The basics</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../prerequisites/">Prerequisites</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../conf/">conf.json</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Back end AngularJS</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
                
            
                <li class="toctree-l3"><a href="#structure">Structure</a></li>
                
                    <li><a class="toctree-l4" href="#main-module-ov">Main module (ov)</a></li>
                
                    <li><a class="toctree-l4" href="#alert-module-ovalert">Alert module (ov.alert)</a></li>
                
                    <li><a class="toctree-l4" href="#authentication-module-ovauthentication">Authentication module (ov.authentication)</a></li>
                
                    <li><a class="toctree-l4" href="#entity-module-oventity">Entity module (ov.entity)</a></li>
                
                    <li><a class="toctree-l4" href="#i18n-module-ovi18n">I18n module (ov.i18n)</a></li>
                
                    <li><a class="toctree-l4" href="#storage-module-ovstorage">Storage module (ov.storage)</a></li>
                
                    <li><a class="toctree-l4" href="#tableform-module-ovtableform">TableForm module (ov.tableForm)</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../write-plugin/">Write a plugin</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../compilation/">CSS / SASS / JS compilation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../template-engine/">Template engine</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../logger/">Logger</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../i18n/">I18N and I10N</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coding-standards/">Coding standards</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../unit-tests/">Unit tests</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../end-to-end-tests/">End to end tests</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../api/">API</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Openveo Core</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>DEVELOPERS &raquo;</li>
        
      
    
    <li>Back end AngularJS</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/veo-labs/openveo-core" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction</h1>
<p>OpenVeo back end is an <a href="https://angularjs.org/">AngularJS</a> single page application served on <strong>/be</strong>.</p>
<p>The back end relies on a couple of libraries :</p>
<ul>
<li><strong>angular-route</strong> to perform single page application routing</li>
<li><strong>angular-animate</strong> for CSS animations</li>
<li><strong>angular-cookies</strong> for cookie management</li>
<li><strong>angular-i18n</strong> for AngularJS default translations</li>
<li><strong>angular-touch</strong> to manage gesture</li>
<li><strong><a href="https://angular-ui.github.io/bootstrap/">angular-bootstrap</a></strong> for basic user interface components</li>
<li><strong><a href="http://angular-formly.com/">angular-formly</a></strong> to build formulars from a JavaScript literal object</li>
<li><strong><a href="http://angular-ui-tree.github.io/angular-ui-tree">angular-ui-tree</a></strong> to build an UI tree (not directly used by openveo-core)</li>
<li><strong><a href="http://vitalets.github.io/angular-xeditable/">angular-xeditable</a></strong> to be able to edit entities in place</li>
<li><strong><a href="https://github.com/noherczeg/ng-jsonpath">ng-jsonpath</a></strong> to search on a JSON object (not directly used by openveo-core)</li>
<li><strong><a href="http://zizzamia.com/ng-tasty/">ng-tasty</a></strong> to present entities in a dynamic paginated table</li>
</ul>
<h1 id="structure">Structure</h1>
<h2 id="main-module-ov">Main module (<strong>ov</strong>)</h2>
<p>The main AngularJS module of the back end is named <strong>ov</strong> and is applied to the HTML root element.</p>
<pre><code class="html">&lt;html ng-app=&quot;ov&quot; ng-controller=&quot;MainController&quot; ng-strict-di&gt;

  &lt;head&gt;
    &lt;base href=&quot;/be/&quot;&gt;
  &lt;/head&gt;

  ...
  &lt;div ng-view&gt;&lt;/div&gt;
  ...
&lt;/html&gt;
</code></pre>

<p>It has dependencies on all AngularJS libraries and all AngularJS modules described by OpenVeo plugins. It also defines all core routes :</p>
<ul>
<li><strong>/be/login</strong> to access the login page</li>
<li><strong>/be</strong> to access the back end home page</li>
<li><strong>/be/applications</strong> to access Web service applications page</li>
<li><strong>/be/users</strong> to access users page</li>
<li><strong>/be/profile</strong> to access user's profile page</li>
<li><strong>/be/roles</strong> to access roles page</li>
</ul>
<p><strong>Nb:</strong> Available services / filters defined in <strong>ov</strong> module are described in the <a href="../../api/back-end/modules/ov.html">API</a>.</p>
<h2 id="alert-module-ovalert">Alert module (<strong>ov.alert</strong>)</h2>
<p>Offers a service to control alerts for the whole application. Alerts are used to display a message to the user.</p>
<p><strong>Nb:</strong> Available services defined in <strong>ov.alert</strong> module are described in the <a href="../../api/back-end/modules/ov.alert.html">API</a>.</p>
<h2 id="authentication-module-ovauthentication">Authentication module (<strong>ov.authentication</strong>)</h2>
<p>Offers a service to authenticate / logout or manipulate authenticated user informations. User information are stored locally using the ov.storage module.</p>
<p><strong>Nb:</strong> Available services / filters defined in <strong>ov.authentication</strong> module are described in the <a href="../../api/back-end/modules/ov.authentication.html">API</a>.</p>
<h2 id="entity-module-oventity">Entity module (<strong>ov.entity</strong>)</h2>
<p>Offers a service to manage (CRUD) OpenVeo entities described in <a href="../../developers/conf">conf.json</a>.</p>
<p><strong>Nb:</strong> Available services defined in <strong>ov.entity</strong> module are described in the <a href="../../api/back-end/modules/ov.entity.html">API</a>.</p>
<h2 id="i18n-module-ovi18n">I18n module (<strong>ov.i18n</strong>)</h2>
<p>Defines a service to control back end internationalization and a <strong>translate</strong> filter to help translate ids from a dictionary.</p>
<p><strong>Nb:</strong> Available services / filters defined in <strong>ov.i18n</strong> module are described in the <a href="../../api/back-end/modules/ov.i18n.html">API</a>.</p>
<h2 id="storage-module-ovstorage">Storage module (<strong>ov.storage</strong>)</h2>
<p>Offers a service to manipulate the local storage.</p>
<p><strong>Nb:</strong> Available services defined in <strong>ov.storage</strong> module are described in the <a href="../../api/back-end/modules/ov.storage.html">API</a>.</p>
<h2 id="tableform-module-ovtableform">TableForm module (<strong>ov.tableForm</strong>)</h2>
<p>Offers a turnkey solution to build formulars and tasty tables.</p>
<p>Formulars are the same as described in <a href="http://angular-formly.com/">angular-formly</a>.</p>
<p>Datatables are a little different from the original <a href="http://zizzamia.com/ng-tasty/">ng-tasty</a> datable as actions can be assigned to a row and information about the row can be edited in place. Datatables needs an associated entity to work.</p>
<h3 id="add-a-new-form">Add a new form</h3>
<p>Formulars are massively based on <a href="http://angular-formly.com/">angular-formly</a>.
To add a new formular, you have to place the generic formular partial in your HTML code and describe the expected form in your controller.</p>
<p>Include formular partial in your HTML.</p>
<pre><code class="html">&lt;ng-include src=&quot;'views/elements/form.html'&quot;&gt;&lt;/ng-include&gt;
</code></pre>

<p>Describes the formular in your controller.</p>
<pre><code class="javascript">
// List of books
$scope.books = [{
  &quot;isbn&quot;: &quot;50&quot;,
  &quot;name&quot;: &quot;Journey to the Center of the Earth&quot;
}];

// Create a scope property &quot;addFormContainer&quot;
$scope.addFormContainer = {};

// Create a property &quot;model&quot; on &quot;addFormContainer&quot;, this is were formly will
// stores form results
// This is the model of the form
$scope.addFormContainer.model = {};

// Describe fields just like in formly documentation
$scope.addFormContainer.fields = [
  {
    key: 'name',
    type: 'horizontalInput',
    templateOptions: {
      label: 'Label of the name field',
      required: true,
      description: 'Description of the name field'
    }
  },
  {
    key: 'books',
    type: 'horizontalCheckList',
    templateOptions: {
      label: 'Books',
      required: false,
      options: $scope.books,
      valueProp: 'isbn',
      labelProp: 'name',
      description: 'List of books'
    },
    expressionProperties: {
      'templateOptions.disabled': '!model.name' // disabled when book name is blank
    }
  }
];

// Add formular submit function
$scope.addFormContainer.onSubmit = function(model) {

  // Return Angularjs promises with its own success or error callback
  // Code to save the formular
  // Generic error or success callback are already chained and executed by the form container
  // in order to display the right message to user and update the form
  return promise;
};
</code></pre>

<h3 id="add-a-new-datatable">Add a new datatable</h3>
<p>Tables are massively based on <a href="http://zizzamia.com/ng-tasty/">ng-tasty</a>.
To add a new datatable, you have to place the generic datatable partial in your HTML code and describe the datatable expected behavior in your controller.</p>
<p>Include datatable partial in your HTML.</p>
<pre><code class="html">&lt;ng-include src=&quot;'views/elements/dataTable.html'&quot;&gt;&lt;/ng-include&gt;
</code></pre>

<p>Describes the datatable in your controller.</p>
<p>For the example, assume that you need to display a collection of <strong>book</strong> entity.</p>
<pre><code class="JSON">{
  &quot;isbn&quot;: &quot;50&quot;,
  &quot;name&quot;: &quot;Journey to the Center of the Earth&quot;,
  &quot;description&quot; : &quot;The story begins in May 1863, in the Lidenbrock house in Hamburg, Germany, with Professor Lidenbrock&quot;
}
</code></pre>

<ul>
<li>Initialize tableContainer Object:</li>
</ul>
<pre><code class="javascript">// Create tableContainer Object used by DataTable controller
$scope.tableContainer = {};

// Initialize the entity type to enable DataTable controller to retrieve the right entity
$scope.tableContainer.entityType = 'book';
</code></pre>

<ul>
<li>Initialize search filters</li>
</ul>
<pre><code class="javascript">$scope.tableContainer.filterBy = [
  {
    key: 'name',  // properties to filter on
    value: '',    // initial value
    label: 'Label of the name search filter'
  }
];
</code></pre>

<p>Filters default type is text. Filter type can be set by adding <strong>type</strong> properties to filter object.</p>
<pre><code class="javascript">{
  key: 'author',
  type: 'select',
  options : selectOptions,
  value: '',
  label: 'Label of the author search filter',
  filterWithChildren: true  // default:false; if true table filter will select with the selectId AND additionnal id set in the &quot;children&quot; key of the selected options
},
{
  key: 'date',
  type: 'date',
  value: '',
  label : 'Label of the date search filter'
}
</code></pre>

<p>Where <strong>selectOptions</strong> need to be describe in this format:</p>
<pre><code class="JSON">[
  {
    &quot;value&quot;: 'id',
    &quot;name&quot;: 'title',
    &quot;children&quot; : 'id1,id2,id3'
  },
  ...
]
</code></pre>

<ul>
<li>Initialize DataTable headers</li>
</ul>
<pre><code class="javascript">// Each column need to display a property,
// Automatically, a sort filter is enable on each column except 'Action' column
$scope.tableContainer.header = [{
  key: 'name',                      // property co display and sort in column    
  name: 'Label of the name column',
  class: ['col-xs-12 col-sm-11']    // css class to add on header cell
},
{
  key: 'action',                    
  name: 'Label for action button' ,
  class: [' hidden-xs col-sm-1'],
}];
</code></pre>

<p>Header object 'action' is <strong>REQUIRED</strong> and not bind any sort filter.</p>
<p>Headers default type is text. Filter type can be set by adding <strong>type</strong> properties to filter object.
Default <strong>date</strong> (timestamp) and <strong>text</strong> value are enabled. 
But you can add any type if you make your own custom cell rendrer (see after)</p>
<pre><code class="javascript">{
  key: 'date', 
  name: 'Label of the date column',
  type: 'date'
},
{
  key: 'author', 
  name: 'Label of the author column',
  type: 'author'
}
</code></pre>

<ul>
<li>Add a custom cell template renderer according to column key and row value</li>
</ul>
<pre><code class="javascript">//Usefull to add HTML value, or filtered value
//if not defined, can print date and text
//if defined, add custom cells renderer to date and text 
$scope.tableContainer.cellTheme = '/path/to/cells/template.html';
</code></pre>

<p>For example (assuming that <strong>entities</strong> is the header type to render, an <strong>row[entities.key]</strong>, the value to display)</p>
<pre><code class="HTML">&lt;span ng-if=&quot;entities.type &amp;&amp; entities.type == 'type1' &amp;&amp; row[entities.key]&quot;&gt;{{row[entities.key] | filterType1}}&lt;/span&gt;
&lt;span ng-if=&quot;entities.type &amp;&amp; entities.type == 'type2'&quot; ng-bind-html=&quot;row[entities.key] | filterType2&quot;&gt;&lt;/span&gt;
</code></pre>

<p><strong> <em>BE CAREFUL ABOUT PERFORMANCES WHEN USING YOUR OWN FILTERS</em> </strong></p>
<ul>
<li>Initialize action enable on each row</li>
</ul>
<pre><code class="javascript">$scope.tableContainer.actions = [{
  label: 'Label of action',

  // Enable a Popup confirmation before action execution, default: false if not defined
  warningPopup: true,

  // Condition to enable the action in the dropdown button action
  condition: function(row) {      
    return $scope.rights.delete &amp;&amp; !row.locked &amp;&amp; !row.saving;
  },

  // Function to execute when the action is executed by button
  callback: function(row, reload) {
    // row is the book object on which the action is executed
    action(row.id);
    // call reload if dataTable need to be reloaded
    reload();
  },

  // Function to execute when the action is executed by select checkbox action
  // If not defined, this action can't be seen in checkbox actions
  global: function(selected, reload) {
    // selected is the list of selected entity id when global action is executed
    // exemple: [12345,12346,12347,12348,12349]
    actions(selected, reload);
  }
}];
</code></pre>

<ul>
<li>Initialize initial sort</li>
</ul>
<pre><code class="javascript">$scope.tableContainer.init = {
  sortBy: 'name',  // initial sort key, default: first header column key if not defined
  sortOrder: 'dsc' // initial sort order, default: 'asc' if not defined
};
</code></pre>

<ul>
<li>Display checkbox global selection</li>
</ul>
<pre><code class="javascript">//default true if not defined;
$scope.tableContainer.showSelectAll = true;
</code></pre>

<p>You can reload a display table manually from other controller by injecting the <strong>TableReloadEventService</strong> and calling</p>
<pre><code class="javascript">tableReloadEventService.broadcast();
</code></pre>

<h3 id="datatable-dependency-edit-a-row">Datatable dependency: edit a row</h3>
<p>DataTable is dependent of an edit form. This form specify what information user can access and/or modify.
All properties described in the <strong><a href="#add-a-new-form">Add a new form</a></strong> section can be used to describe the form.
Main differencies are that the form need to be initialized by the open row (the model is not exposed), and that form fields MUST be extend with an <strong><a href="http://vitalets.github.io/angular-xeditable/">angular-xeditable</a></strong> field</p>
<ul>
<li>Initialize editFormContainer object</li>
</ul>
<pre><code class="javascript">// Create a scope property &quot;editFormContainer&quot;
$scope.addFormContainer = {};

// Create a property &quot;model&quot; on &quot;editFormContainer&quot;, this is were formly will
// stores form results
// This is the model of the form
$scope.editFormContainer.model = {};

// Initialize the entity type to retrieve before the row is updated 
// to always update the latest value in database.
$scope.editFormContainer.entityType = 'book';

// Add formular submit function
$scope.editFormContainer.onSubmit = function(model) {
    return promises;
};

// Define if a row can be toggled or not
$scope.editFormContainer.conditionToggleDetail = function(row) {
  return row.state !== 0;
};
// Define if a row can be edit or not
$scope.editFormContainer.conditionEditDetail = function(row) {
  return !row.locked;
};
</code></pre>

<ul>
<li>Set Fields </li>
</ul>
<pre><code class="javascript">// Describe fields just like in formly documentation, extends with openveo xeditable type
// editableInput, editableChecklist, editableChecklist
$scope.editFormContainer.fields = {
  // the key to be used in the model values
  key: 'name',
  type: 'horizontalExtendInput', //editableInput wrapped with horizontal layout
  templateOptions: {
    label: 'label for name input',
    required: true
  }
};
</code></pre>

<ul>
<li>Set Fields dynamically</li>
</ul>
<pre><code class="javascript">// Function call when the form is displayed
// Usefull to add fields dynamically according to the open row, 
// or retrieve information relative to the row
$scope.editFormContainer.init = function(row) {
  if(row.state == SHOW.PROPERTY){
    var newField = {
      key: 'property',
      type: 'horizontalExtendInput',
      model: row.property,
      templateOptions: {
        label: 'Label of the new property field'
      }
    };
    $scope.editFormContainer.fields.push(newField);
  }
}
</code></pre>

<h3 id="fields-type">Fields type</h3>
<p>In order to enhance forms, you can add your own fields type by specified them in the <strong>formlyConfig</strong> Object in <strong>app.run</strong>:</p>
<pre><code class="javascript">// This type allready in Openveo can right an text in a well componant
formlyConfig.setType({
  name: 'emptyrow',
  template: '&lt;div class=&quot;well well-sm&quot;&gt;{{to.message}}&lt;/div&gt;',
  wrapper: ['horizontalBootstrapLabel', 'bootstrapHasError']
});

// to use it :

$scope.editFormContainer.fields = [
{
  noFormControl: true,
  type: 'emptyrow',
  templateOptions: {
    label: 'label of the not editable row',
    message: 'not editable value to display'
  }
}]
</code></pre>

<p>Xeditable fields that already exist are : editableInput, editableChecklist, editableChecklist, emptyrow</p>
<p>Other xeditable extend fields can be added but, to be used in an edit form, need to be wrapped in the <strong>formlyConfig</strong> Object:</p>
<pre><code class="javascript">    formlyConfig.setType({
      name: 'horizontalExtendFieldType',
      extends: 'editableFieldType',
      wrapper: ['horizontalBootstrapLabel', 'bootstrapHasError']
    });
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../write-plugin/" class="btn btn-neutral float-right" title="Write a plugin"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../conf/" class="btn btn-neutral" title="conf.json"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../conf/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../write-plugin/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
