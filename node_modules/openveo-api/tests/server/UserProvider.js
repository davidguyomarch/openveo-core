"use strict"

var path = require("path");
var assert = require("chai").assert;

// Set module root directory
process.rootAPI = path.join(__dirname, "../../");
process.requireAPI = function(filePath){
  return require(path.normalize(process.rootAPI + "/" + filePath));
};

// Module files
var FakeDatabase = require("./database/FakeDatabase.js");
var UserProvider = process.requireAPI("lib/providers/UserProvider.js");
var userProvider = new UserProvider(new FakeDatabase());

describe("UserProvider", function(){
  
  describe("getUserByCredentials", function(){

    it("should load a user by its credentials", function(done){
      userProvider.getUserByCredentials("openveo", "test", function(testData){
        assert.equal(testData.limit, 1);
        assert.equal(testData.criteria.username, "openveo");
        assert.notEqual(testData.criteria.password, "test");
        assert.equal(testData.projection.password, 0);
        done();
      });

    });

  });
  
  describe("getUserById", function(){

    it("should load a user by its id", function(done){
      userProvider.getUserById("54c7a7ded0909a3b3e8d64c4", function(testData){
        assert.equal(testData.limit, 1);
        assert.equal(testData.criteria.id, "54c7a7ded0909a3b3e8d64c4");
        assert.equal(testData.projection.password, 0);
        done();
      });
    });

  });

});
