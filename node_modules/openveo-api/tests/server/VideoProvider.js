"use strict"

var path = require("path");
var assert = require("chai").assert;

// Set module root directory
process.rootAPI = path.join(__dirname, "../../");
process.requireAPI = function(filePath){
  return require(path.normalize(process.rootAPI + "/" + filePath));
};

var VideoProvider = process.requireAPI("lib/providers/VideoProvider");
var FakeVideoDatabase = require("./database/FakeVideoDatabase.js");
var videoProvider = new VideoProvider(new FakeVideoDatabase());
var counter = 0;

describe("VideoProvider", function(){
  
  describe("add", function(){

    it("should be able to insert a video document into database", function(done){
      videoProvider.add({
        id : "id", 
        status : "status",
        metadata : {},
        url : "url",
        type : "type",
        errorCode : 0
      }, function(error){
        assert.isUndefined(error);
        done();
      });

    });
    
  });
  
  describe("update", function(){  

    it("should be able to queue update requests on the same loop", function(done){

      function increment(){
        counter++; 
      }

      videoProvider.updateStatus("id", "status", function(error){
        counter++;
        assert.equal(counter, 1);
        done();
      });
      videoProvider.updateState("id", "state", increment);
      videoProvider.updateLink("id", "link", increment);
      videoProvider.updateVideoId("id", "videoId", increment);
    }); 
    
  });

});